@using SharedLibrary.DataTransferObjects
@using Microsoft.AspNetCore.Components.Forms
@using RazorLibrary.Shared.LearningModulesInputs
@using RazorLibrary.Helpers
@inherits CreateLearningModule<SharedLibrary.DataTransferObjects.PictureDto>

<PictureInput OnFileInput="OnFileInput"></PictureInput>

@code {
	private IBrowserFile? file;

	protected override string SaveChangesApiPath => "Pictures/Create";
	protected override PictureDto CreateNewDto()
	{
		return new PictureDto(0, 0, string.Empty);
	}

	public override async Task SaveChanges(int termId)
	{
		if (!IsModuleCreationEnabled) return;
		
	    FirstEntity.TermId = termId;

	    var content = new MultipartFormDataContentBuilder()
	        .AddObjectPublicProperties(FirstEntity)
	        .AddFile(file!, MaxAllowedFileSizeInMb)
	        .Build();

		await Http.PostAsync(SaveChangesApiPath, content);
	}

    private void OnFileInput(InputFileChangeEventArgs e)
	{
		file = e.File;
		EnableModuleCreation();
	}
	    
	private const int MaxAllowedFileSizeInMb = 5;
}
